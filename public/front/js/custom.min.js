document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("chat-toggle"),t=document.getElementById("chat-widget"),a=document.getElementById("chat-close");e.addEventListener("click",(()=>{t.style.display="flex"===t.style.display?"none":"flex"})),e.addEventListener("click",(()=>{window.innerWidth<=768?(t.style.display="flex",t.classList.add("fullscreen"),e.style.display="none"):(t.classList.toggle("open"),t.style.display=t.classList.contains("open")?"flex":"none")})),a.addEventListener("click",(()=>{t.style.display="none",t.classList.remove("fullscreen"),e.style.display="flex"}));const n=document.getElementById("chat-box"),o=document.getElementById("chat-form"),s=document.getElementById("message");function r(e,t,a=!1){const o=document.createElement("div");o.classList.add("chat-message",t);const s=document.createElement("div");return s.classList.add("bubble",t),s.innerHTML=a?e:e.replace(/\n/g,"<br>"),o.appendChild(s),n.appendChild(o),n.scrollTop=n.scrollHeight,o}o.addEventListener("submit",(async e=>{e.preventDefault();const t=s.value.trim();if(!t)return;r(t,"user");const a=r("<em>Mengetik...</em>","ai",!0);s.value="";try{const e=(await axios.post("/api/ai-chat",{message:t})).data.reply;a.remove(),r(e,"ai")}catch(e){a.remove(),r("Gagal menghubungi server.","ai")}}))})),document.addEventListener("DOMContentLoaded",(function(){localStorage.getItem("cookieAccepted")||(document.getElementById("cookieConsent").style.display="block"),document.getElementById("acceptCookies").addEventListener("click",(function(){localStorage.setItem("cookieAccepted","yes"),document.getElementById("cookieConsent").style.display="none"}))})),document.querySelectorAll(".dropdown-submenu").forEach((function(e){e.addEventListener("mouseenter",(function(e){e.stopPropagation()})),e.addEventListener("mouseleave",(function(e){e.stopPropagation()}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".hero-parallax-slider .bg-layer");let t=0;setInterval((function(){e[t].classList.remove("show"),t=(t+1)%e.length,e[t].classList.add("show")}),6e3),window.addEventListener("scroll",(function(){const t=window.pageYOffset;e.forEach((e=>{e.style.transform=`translateY(${.25*t}px)`}))}))}));let lastScroll=0;const topHeader=document.querySelector(".top-header"),navbar=document.querySelector(".nav-bar");window.addEventListener("scroll",(function(){const e=window.pageYOffset;if(e<=0)return topHeader.classList.remove("hide"),void navbar.classList.remove("compact");e>lastScroll?(topHeader.classList.add("hide"),navbar.classList.add("compact")):(topHeader.classList.remove("hide"),navbar.classList.remove("compact")),lastScroll=e}));let prevScrollpos=window.pageYOffset;function showToast(e,t){let a=$("#centerToast");$("#centerToastBody").text(e),a.removeClass("bg-success bg-danger").addClass(t),a.show(),new bootstrap.Toast(a[0],{delay:3e3}).show()}window.addEventListener("scroll",(()=>{const e=document.getElementById("navbarBottom");if(!e)return;const t=window.pageYOffset;e.style.bottom=prevScrollpos>t?"0":"-70px",prevScrollpos=t})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("searchOverlay"),t=[document.getElementById("desktopSearchBtn"),document.getElementById("mobileSearchBtn")],a=document.getElementById("closeSearch"),n=document.querySelector(".custom-toggler");t.forEach((t=>t?.addEventListener("click",(()=>e?.classList.add("active"))))),a?.addEventListener("click",(()=>e?.classList.remove("active"))),n?.addEventListener("click",(()=>n.classList.toggle("active")))})),$((function(){$("#current_pwd").on("keyup",(function(){const e=$(this).val();$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/check-current-password",data:{current_pwd:e},success:function(e){const t="true"===e?"Password yang anda masukkan benar!":"Password yang anda masukkan salah";$("#verifyCurrentPwd").text(t)},error:function(){$("#verifyCurrentPwd").text("Error!")}})})),$("#sort").on("change",(function(){this.form.submit()})),$("#addCart").on("submit",(function(e){e.preventDefault();const t=$("#start").val(),a=$("#end").val(),n=(e,t)=>{const a="success"===e?"alert-success":"alert-danger",n="success"===e?".print-success-msg":".print-error-msg";$(".print-error-msg, .print-success-msg").hide(),$(n).html(`\n                    <div class="alert ${a} alert-dismissible fade show" role="alert">\n                        ${t}\n                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n                    </div>\n                `).fadeIn(200),setTimeout((()=>{$(n).fadeOut(400,(()=>$(n).empty()))}),3e3)};if(!t||!a)return n("error","Silakan pilih tanggal mulai dan tanggal selesai.");const o=new Date;o.setHours(0,0,0,0);const s=new Date(t),r=new Date(a);return s<o?n("error","Tanggal mulai tidak boleh sebelum hari ini."):r<s?n("error","Tanggal selesai tidak boleh lebih awal dari tanggal mulai."):void $.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/addCart",data:$(this).serialize(),beforeSend:function(){$(".print-error-msg, .print-success-msg").hide()},success:function(e){e.status?(n("success",e.message),void 0!==e.totalCartItems&&$("#totalCartItems").html(e.totalCartItems),e.view&&$("#appendCartItems").html(e.view),e.minicartview&&$("#appendMiniCartItems").html(e.minicartview),$("#addCart")[0].reset()):n("error",e.message)},error:function(e,t,a){console.error("AJAX Error:",t,a),n("error","Terjadi kesalahan saat mengirim data. Silakan coba lagi.")}})})),$(document).on("click",".confirmDelete",(function(){var e=$(this).attr("record"),t=$(this).attr("recordid");Swal.fire({title:"Apakah anda yakin?",text:"Anda tidak dapat mengembalikan data yang sudah dihapus!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Hapus!"}).then((a=>{a.isConfirmed&&(Swal.fire({title:"Terhapus",text:"Data sudah dihapus",icon:"success"}),window.location.href="/cart/delete-"+e+"/"+t)}))})),$(document).on("click",".deleteCartItem",(function(){const e=$(this).data("cartid");confirm("Apakah anda ingin menghapus dari keranjang?")&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/cart/delete-cart-item",data:{cartid:e},success:function(e){$("#totalCartItems").html(e.totalCartItems),$("#appendCartItems").html(e.view),$("#appendMiniCartItems").html(e.minicartview)},error:function(){console.error("Terjadi kesalahan saat menghapus item.")}})})),$(document).on("click","#ApplyCoupon",(function(e){e.preventDefault();if(!(1==$(this).data("user")))return alert("Silakan login untuk menggunakan kupon."),!1;const t=$("#code").val().trim();if(""===t)return alert("Silakan masukkan kode kupon terlebih dahulu."),!1;$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/apply-coupon",data:{code:t},beforeSend:function(){$("#ApplyCoupon").prop("disabled",!0).text("Memproses...")},success:function(e){const t=!0===e.status,a=t?"alert-success":"alert-danger";$(`.${a}`).html(`\n                <div class="alert ${a} alert-dismissible fade show" role="alert">\n                    <strong>${e.message}</strong>\n                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n                </div>\n            `).fadeIn().delay(4e3).fadeOut("slow"),t&&($(".couponAmount").text(e.couponAmountFormatted??"Rp 0"),$(".grandTotal").text(e.grandTotalFormatted??"Rp 0"),e.view&&$("#appendCartItems").html(e.view),e.minicartview&&$("#appendMiniCartItems").html(e.minicartview),e.totalCartItems&&$("#totalCartItems").html(e.totalCartItems))},error:function(){alert("Terjadi kesalahan saat memproses kupon.")},complete:function(){$("#ApplyCoupon").prop("disabled",!1).text("Pakai")}})})),$("#ManualCoupon").on("click",(()=>$("#couponField").show())),$("#AutomaticCoupon").on("click",(()=>$("#couponField").hide()))})),$("#newsletterForm").on("submit",(function(e){e.preventDefault();var t=$(this),a=$("#newsletterEmail").val(),n=t.find('input[name="_token"]').val();$.ajax({url:"/newsletter/store",type:"POST",data:{email:a,_token:n},success:function(e){showToast(e.message,e.success?"bg-success":"bg-danger"),e.success&&t[0].reset()},error:function(e){showToast(e.responseJSON?.errors?.email?.[0]||"Terjadi kesalahan. Coba lagi.","bg-danger")}})})),function(e){"use strict";setTimeout((function(){e("#spinner").length>0&&e("#spinner").removeClass("show")}),1),(new WOW).init(),e(window).scroll((function(){e(this).scrollTop()>45?e(".nav-bar").addClass("sticky-top"):e(".nav-bar").removeClass("sticky-top")})),e(window).scroll((function(){e(this).scrollTop()>300?e(".back-to-top").fadeIn("slow"):e(".back-to-top").fadeOut("slow")})),e(".back-to-top").click((function(){return e("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1})),e(".header-carousel").owlCarousel({autoplay:!0,smartSpeed:1500,items:1,dots:!0,loop:!0,nav:!0,navText:['<i class="bi bi-chevron-left"></i>','<i class="bi bi-chevron-right"></i>']}),e(".testimonial-carousel").owlCarousel({autoplay:!0,smartSpeed:1e3,margin:24,dots:!1,loop:!0,nav:!0,navText:['<i class="bi bi-arrow-left"></i>','<i class="bi bi-arrow-right"></i>'],responsive:{0:{items:1},992:{items:2}}})}(jQuery),$(document).ready((function(){$(document).on("click",".uploadProofBtn",(function(){var e=$(this).data("orderid");$("#order_id").val(e),$("#payment_proof").val(""),$("#previewImage").html("")})),$("#payment_proof").on("change",(function(){var e=this.files[0];if(e){if(e.size>2097152)return alert("Ukuran file maksimal 2MB!"),void $(this).val("");var t=new FileReader;t.onload=function(e){$("#previewImage").html('<img src="'+e.target.result+'" class="img-fluid rounded mt-2 shadow-sm" style="max-height:200px;">')},t.readAsDataURL(e)}})),$("#uploadProofForm").on("submit",(function(e){e.preventDefault();var t=new FormData(this);$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:"/upload-payment-proof",data:t,processData:!1,contentType:!1,beforeSend:function(){$('#uploadProofForm button[type="submit"]').prop("disabled",!0).text("Mengunggah...")},success:function(e){$('#uploadProofForm button[type="submit"]').prop("disabled",!1).text("Upload"),$("#uploadProofModal").modal("hide"),alert(e.message||"Bukti pembayaran berhasil diunggah!"),location.reload()},error:function(e){$('#uploadProofForm button[type="submit"]').prop("disabled",!1).text("Upload"),alert(e.responseJSON?.message||"Terjadi kesalahan. Coba lagi.")}})})),$(document).on("click",".viewProofBtn",(function(){const e=$(this).data("proof"),t=$("#proofImageContainer");e?t.html(`\n            <img src="${e}" alt="Bukti Pembayaran" class="img-fluid rounded shadow-sm mb-3" style="max-height:500px;">\n            <br>\n            <a href="${e}" class="btn btn-primary" target="_blank">\n                <i class="fa fa-download"></i> Unduh Bukti\n            </a>\n        `):t.html('<div class="text-muted">Bukti pembayaran tidak ditemukan.</div>')}))}));